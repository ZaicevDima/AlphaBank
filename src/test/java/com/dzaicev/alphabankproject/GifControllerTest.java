package com.dzaicev.alphabankproject;

import com.dzaicev.alphabankproject.controllers.CurrencyController;
import com.dzaicev.alphabankproject.controllers.GifController;
import com.dzaicev.alphabankproject.data.Currency;
import com.dzaicev.alphabankproject.data.CurrencyPair;
import com.dzaicev.alphabankproject.data.Gif;
import com.dzaicev.alphabankproject.exceptions.IncorrectCurrencyException;
import com.dzaicev.alphabankproject.feign.GifClient;
import org.json.JSONException;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.junit.runner.RunWith;
import org.powermock.core.classloader.annotations.PrepareForTest;
import org.powermock.modules.junit4.PowerMockRunner;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.test.util.ReflectionTestUtils;

import static org.junit.jupiter.api.Assertions.*;
import static org.powermock.api.mockito.PowerMockito.*;

@PrepareForTest(fullyQualifiedNames = "com.dzaicev.alphabankproject.controllers.CurrencyController")
@RunWith(PowerMockRunner.class)
public class GifControllerTest {
    private final CurrencyController currencyController = mock(CurrencyController.class);
    private final GifClient gifClient = mock(GifClient.class);
    private final GifController gifController = spy(new GifController(gifClient, currencyController));

    @BeforeEach
    public void before() throws IncorrectCurrencyException {
        ResponseEntity<String> gifRichJSON = new ResponseEntity<>("{\"data\":[{\"type\":\"gif\",\"id\":\"lptjRBxFKCJmFoibP3\",\"url\":\"https://giphy.com/gifs/andersonpaak-money-pool-lptjRBxFKCJmFoibP3\",\"slug\":\"andersonpaak-money-pool-lptjRBxFKCJmFoibP3\",\"bitly_gif_url\":\"https://gph.is/2wNpo5P\",\"bitly_url\":\"https://gph.is/2wNpo5P\",\"embed_url\":\"https://giphy.com/embed/lptjRBxFKCJmFoibP3\",\"username\":\"andersonpaak\",\"source\":\"\",\"title\":\"Super League Money GIF by Anderson .Paak\",\"rating\":\"g\",\"content_url\":\"\",\"source_tld\":\"\",\"source_post_url\":\"\",\"is_sticker\":0,\"import_datetime\":\"2018-05-17 19:08:01\",\"trending_datetime\":\"0000-00-00 00:00:00\",\"images\":{\"original\":{\"height\":\"270\",\"width\":\"480\",\"size\":\"5873160\",\"url\":\"https://media1.giphy.com/media/lptjRBxFKCJmFoibP3/giphy.gif?cid=ca373e9ax5485u65nbi6qad38tehroivrsilpsit8etwxna7&rid=giphy.gif&ct=g\",\"mp4_size\":\"1186324\",\"mp4\":\"https://media1.giphy.com/media/lptjRBxFKCJmFoibP3/giphy.mp4?cid=ca373e9ax5485u65nbi6qad38tehroivrsilpsit8etwxna7&rid=giphy.mp4&ct=g\",\"webp_size\":\"1858810\",\"webp\":\"https://media1.giphy.com/media/lptjRBxFKCJmFoibP3/giphy.webp?cid=ca373e9ax5485u65nbi6qad38tehroivrsilpsit8etwxna7&rid=giphy.webp&ct=g\",\"frames\":\"65\",\"hash\":\"c954d468a9486db13c102d7e52b9b4ce\"},\"downsized\":{\"height\":\"155\",\"width\":\"276\",\"size\":\"1241026\",\"url\":\"https://media1.giphy.com/media/lptjRBxFKCJmFoibP3/giphy-downsized.gif?cid=ca373e9ax5485u65nbi6qad38tehroivrsilpsit8etwxna7&rid=giphy-downsized.gif&ct=g\"},\"downsized_large\":{\"height\":\"270\",\"width\":\"480\",\"size\":\"5873160\",\"url\":\"https://media1.giphy.com/media/lptjRBxFKCJmFoibP3/giphy.gif?cid=ca373e9ax5485u65nbi6qad38tehroivrsilpsit8etwxna7&rid=giphy.gif&ct=g\"},\"downsized_medium\":{\"height\":\"270\",\"width\":\"480\",\"size\":\"4173540\",\"url\":\"https://media1.giphy.com/media/lptjRBxFKCJmFoibP3/giphy-downsized-medium.gif?cid=ca373e9ax5485u65nbi6qad38tehroivrsilpsit8etwxna7&rid=giphy-downsized-medium.gif&ct=g\"},\"downsized_small\":{\"height\":\"108\",\"width\":\"192\",\"mp4_size\":\"120726\",\"mp4\":\"https://media1.giphy.com/media/lptjRBxFKCJmFoibP3/giphy-downsized-small.mp4?cid=ca373e9ax5485u65nbi6qad38tehroivrsilpsit8etwxna7&rid=giphy-downsized-small.mp4&ct=g\"},\"downsized_still\":{\"height\":\"155\",\"width\":\"276\",\"size\":\"22111\",\"url\":\"https://media1.giphy.com/media/lptjRBxFKCJmFoibP3/giphy-downsized_s.gif?cid=ca373e9ax5485u65nbi6qad38tehroivrsilpsit8etwxna7&rid=giphy-downsized_s.gif&ct=g\"},\"fixed_height\":{\"height\":\"200\",\"width\":\"356\",\"size\":\"2505371\",\"url\":\"https://media1.giphy.com/media/lptjRBxFKCJmFoibP3/200.gif?cid=ca373e9ax5485u65nbi6qad38tehroivrsilpsit8etwxna7&rid=200.gif&ct=g\",\"mp4_size\":\"682326\",\"mp4\":\"https://media1.giphy.com/media/lptjRBxFKCJmFoibP3/200.mp4?cid=ca373e9ax5485u65nbi6qad38tehroivrsilpsit8etwxna7&rid=200.mp4&ct=g\",\"webp_size\":\"1116502\",\"webp\":\"https://media1.giphy.com/media/lptjRBxFKCJmFoibP3/200.webp?cid=ca373e9ax5485u65nbi6qad38tehroivrsilpsit8etwxna7&rid=200.webp&ct=g\"},\"fixed_height_downsampled\":{\"height\":\"200\",\"width\":\"356\",\"size\":\"234058\",\"url\":\"https://media1.giphy.com/media/lptjRBxFKCJmFoibP3/200_d.gif?cid=ca373e9ax5485u65nbi6qad38tehroivrsilpsit8etwxna7&rid=200_d.gif&ct=g\",\"webp_size\":\"166998\",\"webp\":\"https://media1.giphy.com/media/lptjRBxFKCJmFoibP3/200_d.webp?cid=ca373e9ax5485u65nbi6qad38tehroivrsilpsit8etwxna7&rid=200_d.webp&ct=g\"},\"fixed_height_small\":{\"height\":\"100\",\"width\":\"178\",\"size\":\"784609\",\"url\":\"https://media1.giphy.com/media/lptjRBxFKCJmFoibP3/100.gif?cid=ca373e9ax5485u65nbi6qad38tehroivrsilpsit8etwxna7&rid=100.gif&ct=g\",\"mp4_size\":\"206291\",\"mp4\":\"https://media1.giphy.com/media/lptjRBxFKCJmFoibP3/100.mp4?cid=ca373e9ax5485u65nbi6qad38tehroivrsilpsit8etwxna7&rid=100.mp4&ct=g\",\"webp_size\":\"306900\",\"webp\":\"https://media1.giphy.com/media/lptjRBxFKCJmFoibP3/100.webp?cid=ca373e9ax5485u65nbi6qad38tehroivrsilpsit8etwxna7&rid=100.webp&ct=g\"},\"fixed_height_small_still\":{\"height\":\"100\",\"width\":\"178\",\"size\":\"13204\",\"url\":\"https://media1.giphy.com/media/lptjRBxFKCJmFoibP3/100_s.gif?cid=ca373e9ax5485u65nbi6qad38tehroivrsilpsit8etwxna7&rid=100_s.gif&ct=g\"},\"fixed_height_still\":{\"height\":\"200\",\"width\":\"356\",\"size\":\"40138\",\"url\":\"https://media1.giphy.com/media/lptjRBxFKCJmFoibP3/200_s.gif?cid=ca373e9ax5485u65nbi6qad38tehroivrsilpsit8etwxna7&rid=200_s.gif&ct=g\"},\"fixed_width\":{\"height\":\"113\",\"width\":\"200\",\"size\":\"1079494\",\"url\":\"https://media1.giphy.com/media/lptjRBxFKCJmFoibP3/200w.gif?cid=ca373e9ax5485u65nbi6qad38tehroivrsilpsit8etwxna7&rid=200w.gif&ct=g\",\"mp4_size\":\"241994\",\"mp4\":\"https://media1.giphy.com/media/lptjRBxFKCJmFoibP3/200w.mp4?cid=ca373e9ax5485u65nbi6qad38tehroivrsilpsit8etwxna7&rid=200w.mp4&ct=g\",\"webp_size\":\"381610\",\"webp\":\"https://media1.giphy.com/media/lptjRBxFKCJmFoibP3/200w.webp?cid=ca373e9ax5485u65nbi6qad38tehroivrsilpsit8etwxna7&rid=200w.webp&ct=g\"},\"fixed_width_downsampled\":{\"height\":\"113\",\"width\":\"200\",\"size\":\"100101\",\"url\":\"https://media1.giphy.com/media/lptjRBxFKCJmFoibP3/200w_d.gif?cid=ca373e9ax5485u65nbi6qad38tehroivrsilpsit8etwxna7&rid=200w_d.gif&ct=g\",\"webp_size\":\"57320\",\"webp\":\"https://media1.giphy.com/media/lptjRBxFKCJmFoibP3/200w_d.webp?cid=ca373e9ax5485u65nbi6qad38tehroivrsilpsit8etwxna7&rid=200w_d.webp&ct=g\"},\"fixed_width_small\":{\"height\":\"57\",\"width\":\"100\",\"size\":\"258794\",\"url\":\"https://media1.giphy.com/media/lptjRBxFKCJmFoibP3/100w.gif?cid=ca373e9ax5485u65nbi6qad38tehroivrsilpsit8etwxna7&rid=100w.gif&ct=g\",\"mp4_size\":\"49523\",\"mp4\":\"https://media1.giphy.com/media/lptjRBxFKCJmFoibP3/100w.mp4?cid=ca373e9ax5485u65nbi6qad38tehroivrsilpsit8etwxna7&rid=100w.mp4&ct=g\",\"webp_size\":\"108402\",\"webp\":\"https://media1.giphy.com/media/lptjRBxFKCJmFoibP3/100w.webp?cid=ca373e9ax5485u65nbi6qad38tehroivrsilpsit8etwxna7&rid=100w.webp&ct=g\"},\"fixed_width_small_still\":{\"height\":\"57\",\"width\":\"100\",\"size\":\"4768\",\"url\":\"https://media1.giphy.com/media/lptjRBxFKCJmFoibP3/100w_s.gif?cid=ca373e9ax5485u65nbi6qad38tehroivrsilpsit8etwxna7&rid=100w_s.gif&ct=g\"},\"fixed_width_still\":{\"height\":\"113\",\"width\":\"200\",\"size\":\"17040\",\"url\":\"https://media1.giphy.com/media/lptjRBxFKCJmFoibP3/200w_s.gif?cid=ca373e9ax5485u65nbi6qad38tehroivrsilpsit8etwxna7&rid=200w_s.gif&ct=g\"},\"looping\":{\"mp4_size\":\"7843022\",\"mp4\":\"https://media1.giphy.com/media/lptjRBxFKCJmFoibP3/giphy-loop.mp4?cid=ca373e9ax5485u65nbi6qad38tehroivrsilpsit8etwxna7&rid=giphy-loop.mp4&ct=g\"},\"original_still\":{\"height\":\"270\",\"width\":\"480\",\"size\":\"99733\",\"url\":\"https://media1.giphy.com/media/lptjRBxFKCJmFoibP3/giphy_s.gif?cid=ca373e9ax5485u65nbi6qad38tehroivrsilpsit8etwxna7&rid=giphy_s.gif&ct=g\"},\"original_mp4\":{\"height\":\"270\",\"width\":\"480\",\"mp4_size\":\"1186324\",\"mp4\":\"https://media1.giphy.com/media/lptjRBxFKCJmFoibP3/giphy.mp4?cid=ca373e9ax5485u65nbi6qad38tehroivrsilpsit8etwxna7&rid=giphy.mp4&ct=g\"},\"preview\":{\"height\":\"98\",\"width\":\"174\",\"mp4_size\":\"45115\",\"mp4\":\"https://media1.giphy.com/media/lptjRBxFKCJmFoibP3/giphy-preview.mp4?cid=ca373e9ax5485u65nbi6qad38tehroivrsilpsit8etwxna7&rid=giphy-preview.mp4&ct=g\"},\"preview_gif\":{\"height\":\"69\",\"width\":\"123\",\"size\":\"49629\",\"url\":\"https://media1.giphy.com/media/lptjRBxFKCJmFoibP3/giphy-preview.gif?cid=ca373e9ax5485u65nbi6qad38tehroivrsilpsit8etwxna7&rid=giphy-preview.gif&ct=g\"},\"preview_webp\":{\"height\":\"62\",\"width\":\"110\",\"size\":\"29678\",\"url\":\"https://media1.giphy.com/media/lptjRBxFKCJmFoibP3/giphy-preview.webp?cid=ca373e9ax5485u65nbi6qad38tehroivrsilpsit8etwxna7&rid=giphy-preview.webp&ct=g\"},\"hd\":{\"height\":\"562\",\"width\":\"1000\",\"mp4_size\":\"5663007\",\"mp4\":\"https://media1.giphy.com/media/lptjRBxFKCJmFoibP3/giphy-hd.mp4?cid=ca373e9ax5485u65nbi6qad38tehroivrsilpsit8etwxna7&rid=giphy-hd.mp4&ct=g\"},\"480w_still\":{\"height\":\"270\",\"width\":\"480\",\"size\":\"5873160\",\"url\":\"https://media1.giphy.com/media/lptjRBxFKCJmFoibP3/480w_s.jpg?cid=ca373e9ax5485u65nbi6qad38tehroivrsilpsit8etwxna7&rid=480w_s.jpg&ct=g\"}},\"user\":{\"avatar_url\":\"https://media3.giphy.com/avatars/andersonpaak/fB065ocbG87e.jpg\",\"banner_image\":\"https://media3.giphy.com/headers/andersonpaak/mJHINf26G4jF.jpg\",\"banner_url\":\"https://media3.giphy.com/headers/andersonpaak/mJHINf26G4jF.jpg\",\"profile_url\":\"https://giphy.com/andersonpaak/\",\"username\":\"andersonpaak\",\"display_name\":\"Anderson .Paak\",\"description\":\"O X N A R D OUT NOW\\r\\nbuy.andersonpaak.com\\r\\nsmarturl.it/OXNARD\",\"instagram_url\":\"https://instagram.com/anderson._paak\",\"website_url\":\"http://www.andersonpaak.com/\",\"is_verified\":true},\"analytics_response_payload\":\"e=Z2lmX2lkPWxwdGpSQnhGS0NKbUZvaWJQMyZldmVudF90eXBlPUdJRl9TRUFSQ0gmY2lkPWNhMzczZTlheDU0ODV1NjVuYmk2cWFkMzh0ZWhyb2l2cnNpbHBzaXQ4ZXR3eG5hNyZjdD1naWY\",\"analytics\":{\"onload\":{\"url\":\"https://giphy-analytics.giphy.com/v2/pingback_simple?analytics_response_payload=e%3DZ2lmX2lkPWxwdGpSQnhGS0NKbUZvaWJQMyZldmVudF90eXBlPUdJRl9TRUFSQ0gmY2lkPWNhMzczZTlheDU0ODV1NjVuYmk2cWFkMzh0ZWhyb2l2cnNpbHBzaXQ4ZXR3eG5hNyZjdD1naWY&action_type=SEEN\"},\"onclick\":{\"url\":\"https://giphy-analytics.giphy.com/v2/pingback_simple?analytics_response_payload=e%3DZ2lmX2lkPWxwdGpSQnhGS0NKbUZvaWJQMyZldmVudF90eXBlPUdJRl9TRUFSQ0gmY2lkPWNhMzczZTlheDU0ODV1NjVuYmk2cWFkMzh0ZWhyb2l2cnNpbHBzaXQ4ZXR3eG5hNyZjdD1naWY&action_type=CLICK\"},\"onsent\":{\"url\":\"https://giphy-analytics.giphy.com/v2/pingback_simple?analytics_response_payload=e%3DZ2lmX2lkPWxwdGpSQnhGS0NKbUZvaWJQMyZldmVudF90eXBlPUdJRl9TRUFSQ0gmY2lkPWNhMzczZTlheDU0ODV1NjVuYmk2cWFkMzh0ZWhyb2l2cnNpbHBzaXQ4ZXR3eG5hNyZjdD1naWY&action_type=SENT\"}}}],\"pagination\":{\"total_count\":8920,\"count\":1,\"offset\":0},\"meta\":{\"status\":200,\"msg\":\"OK\",\"response_id\":\"x5485u65nbi6qad38tehroivrsilpsit8etwxna7\"}}", HttpStatus.OK);
        ResponseEntity<String> gifBrokeJSON = new ResponseEntity<>("{\"data\":[{\"type\":\"gif\",\"id\":\"ZGH8VtTZMmnwzsYYMf\",\"url\":\"https://giphy.com/gifs/mostexpensivest-viceland-2-chainz-most-expensivest-ZGH8VtTZMmnwzsYYMf\",\"slug\":\"mostexpensivest-viceland-2-chainz-most-expensivest-ZGH8VtTZMmnwzsYYMf\",\"bitly_gif_url\":\"https://gph.is/g/E3lAKJx\",\"bitly_url\":\"https://gph.is/g/E3lAKJx\",\"embed_url\":\"https://giphy.com/embed/ZGH8VtTZMmnwzsYYMf\",\"username\":\"mostexpensivest\",\"source\":\"\",\"title\":\"2 Chainz Pockets GIF by MOST EXPENSIVEST\",\"rating\":\"g\",\"content_url\":\"\",\"source_tld\":\"\",\"source_post_url\":\"\",\"is_sticker\":0,\"import_datetime\":\"2019-07-29 14:55:52\",\"trending_datetime\":\"0000-00-00 00:00:00\",\"images\":{\"original\":{\"height\":\"270\",\"width\":\"480\",\"size\":\"935092\",\"url\":\"https://media0.giphy.com/media/ZGH8VtTZMmnwzsYYMf/giphy.gif?cid=ca373e9auminic0o5gpi2kjp19m8wd19eicgkci0siyp18mr&rid=giphy.gif&ct=g\",\"mp4_size\":\"178155\",\"mp4\":\"https://media0.giphy.com/media/ZGH8VtTZMmnwzsYYMf/giphy.mp4?cid=ca373e9auminic0o5gpi2kjp19m8wd19eicgkci0siyp18mr&rid=giphy.mp4&ct=g\",\"webp_size\":\"312820\",\"webp\":\"https://media0.giphy.com/media/ZGH8VtTZMmnwzsYYMf/giphy.webp?cid=ca373e9auminic0o5gpi2kjp19m8wd19eicgkci0siyp18mr&rid=giphy.webp&ct=g\",\"frames\":\"30\",\"hash\":\"02da6ac1ff548dfc0c9bc8d5f914a8d2\"},\"downsized\":{\"height\":\"270\",\"width\":\"480\",\"size\":\"935092\",\"url\":\"https://media0.giphy.com/media/ZGH8VtTZMmnwzsYYMf/giphy.gif?cid=ca373e9auminic0o5gpi2kjp19m8wd19eicgkci0siyp18mr&rid=giphy.gif&ct=g\"},\"downsized_large\":{\"height\":\"270\",\"width\":\"480\",\"size\":\"935092\",\"url\":\"https://media0.giphy.com/media/ZGH8VtTZMmnwzsYYMf/giphy.gif?cid=ca373e9auminic0o5gpi2kjp19m8wd19eicgkci0siyp18mr&rid=giphy.gif&ct=g\"},\"downsized_medium\":{\"height\":\"270\",\"width\":\"480\",\"size\":\"935092\",\"url\":\"https://media0.giphy.com/media/ZGH8VtTZMmnwzsYYMf/giphy.gif?cid=ca373e9auminic0o5gpi2kjp19m8wd19eicgkci0siyp18mr&rid=giphy.gif&ct=g\"},\"downsized_small\":{\"height\":\"270\",\"width\":\"480\",\"mp4_size\":\"178155\",\"mp4\":\"https://media0.giphy.com/media/ZGH8VtTZMmnwzsYYMf/giphy-downsized-small.mp4?cid=ca373e9auminic0o5gpi2kjp19m8wd19eicgkci0siyp18mr&rid=giphy-downsized-small.mp4&ct=g\"},\"downsized_still\":{\"height\":\"270\",\"width\":\"480\",\"size\":\"935092\",\"url\":\"https://media0.giphy.com/media/ZGH8VtTZMmnwzsYYMf/giphy_s.gif?cid=ca373e9auminic0o5gpi2kjp19m8wd19eicgkci0siyp18mr&rid=giphy_s.gif&ct=g\"},\"fixed_height\":{\"height\":\"200\",\"width\":\"356\",\"size\":\"497906\",\"url\":\"https://media0.giphy.com/media/ZGH8VtTZMmnwzsYYMf/200.gif?cid=ca373e9auminic0o5gpi2kjp19m8wd19eicgkci0siyp18mr&rid=200.gif&ct=g\",\"mp4_size\":\"109218\",\"mp4\":\"https://media0.giphy.com/media/ZGH8VtTZMmnwzsYYMf/200.mp4?cid=ca373e9auminic0o5gpi2kjp19m8wd19eicgkci0siyp18mr&rid=200.mp4&ct=g\",\"webp_size\":\"223426\",\"webp\":\"https://media0.giphy.com/media/ZGH8VtTZMmnwzsYYMf/200.webp?cid=ca373e9auminic0o5gpi2kjp19m8wd19eicgkci0siyp18mr&rid=200.webp&ct=g\"},\"fixed_height_downsampled\":{\"height\":\"200\",\"width\":\"356\",\"size\":\"139711\",\"url\":\"https://media0.giphy.com/media/ZGH8VtTZMmnwzsYYMf/200_d.gif?cid=ca373e9auminic0o5gpi2kjp19m8wd19eicgkci0siyp18mr&rid=200_d.gif&ct=g\",\"webp_size\":\"100388\",\"webp\":\"https://media0.giphy.com/media/ZGH8VtTZMmnwzsYYMf/200_d.webp?cid=ca373e9auminic0o5gpi2kjp19m8wd19eicgkci0siyp18mr&rid=200_d.webp&ct=g\"},\"fixed_height_small\":{\"height\":\"100\",\"width\":\"178\",\"size\":\"184568\",\"url\":\"https://media0.giphy.com/media/ZGH8VtTZMmnwzsYYMf/100.gif?cid=ca373e9auminic0o5gpi2kjp19m8wd19eicgkci0siyp18mr&rid=100.gif&ct=g\",\"mp4_size\":\"37337\",\"mp4\":\"https://media0.giphy.com/media/ZGH8VtTZMmnwzsYYMf/100.mp4?cid=ca373e9auminic0o5gpi2kjp19m8wd19eicgkci0siyp18mr&rid=100.mp4&ct=g\",\"webp_size\":\"87124\",\"webp\":\"https://media0.giphy.com/media/ZGH8VtTZMmnwzsYYMf/100.webp?cid=ca373e9auminic0o5gpi2kjp19m8wd19eicgkci0siyp18mr&rid=100.webp&ct=g\"},\"fixed_height_small_still\":{\"height\":\"100\",\"width\":\"178\",\"size\":\"8268\",\"url\":\"https://media0.giphy.com/media/ZGH8VtTZMmnwzsYYMf/100_s.gif?cid=ca373e9auminic0o5gpi2kjp19m8wd19eicgkci0siyp18mr&rid=100_s.gif&ct=g\"},\"fixed_height_still\":{\"height\":\"200\",\"width\":\"356\",\"size\":\"20352\",\"url\":\"https://media0.giphy.com/media/ZGH8VtTZMmnwzsYYMf/200_s.gif?cid=ca373e9auminic0o5gpi2kjp19m8wd19eicgkci0siyp18mr&rid=200_s.gif&ct=g\"},\"fixed_width\":{\"height\":\"113\",\"width\":\"200\",\"size\":\"198960\",\"url\":\"https://media0.giphy.com/media/ZGH8VtTZMmnwzsYYMf/200w.gif?cid=ca373e9auminic0o5gpi2kjp19m8wd19eicgkci0siyp18mr&rid=200w.gif&ct=g\",\"mp4_size\":\"42955\",\"mp4\":\"https://media0.giphy.com/media/ZGH8VtTZMmnwzsYYMf/200w.mp4?cid=ca373e9auminic0o5gpi2kjp19m8wd19eicgkci0siyp18mr&rid=200w.mp4&ct=g\",\"webp_size\":\"99822\",\"webp\":\"https://media0.giphy.com/media/ZGH8VtTZMmnwzsYYMf/200w.webp?cid=ca373e9auminic0o5gpi2kjp19m8wd19eicgkci0siyp18mr&rid=200w.webp&ct=g\"},\"fixed_width_downsampled\":{\"height\":\"113\",\"width\":\"200\",\"size\":\"56713\",\"url\":\"https://media0.giphy.com/media/ZGH8VtTZMmnwzsYYMf/200w_d.gif?cid=ca373e9auminic0o5gpi2kjp19m8wd19eicgkci0siyp18mr&rid=200w_d.gif&ct=g\",\"webp_size\":\"38148\",\"webp\":\"https://media0.giphy.com/media/ZGH8VtTZMmnwzsYYMf/200w_d.webp?cid=ca373e9auminic0o5gpi2kjp19m8wd19eicgkci0siyp18mr&rid=200w_d.webp&ct=g\"},\"fixed_width_small\":{\"height\":\"57\",\"width\":\"100\",\"size\":\"73425\",\"url\":\"https://media0.giphy.com/media/ZGH8VtTZMmnwzsYYMf/100w.gif?cid=ca373e9auminic0o5gpi2kjp19m8wd19eicgkci0siyp18mr&rid=100w.gif&ct=g\",\"mp4_size\":\"14565\",\"mp4\":\"https://media0.giphy.com/media/ZGH8VtTZMmnwzsYYMf/100w.mp4?cid=ca373e9auminic0o5gpi2kjp19m8wd19eicgkci0siyp18mr&rid=100w.mp4&ct=g\",\"webp_size\":\"37150\",\"webp\":\"https://media0.giphy.com/media/ZGH8VtTZMmnwzsYYMf/100w.webp?cid=ca373e9auminic0o5gpi2kjp19m8wd19eicgkci0siyp18mr&rid=100w.webp&ct=g\"},\"fixed_width_small_still\":{\"height\":\"57\",\"width\":\"100\",\"size\":\"3483\",\"url\":\"https://media0.giphy.com/media/ZGH8VtTZMmnwzsYYMf/100w_s.gif?cid=ca373e9auminic0o5gpi2kjp19m8wd19eicgkci0siyp18mr&rid=100w_s.gif&ct=g\"},\"fixed_width_still\":{\"height\":\"113\",\"width\":\"200\",\"size\":\"10929\",\"url\":\"https://media0.giphy.com/media/ZGH8VtTZMmnwzsYYMf/200w_s.gif?cid=ca373e9auminic0o5gpi2kjp19m8wd19eicgkci0siyp18mr&rid=200w_s.gif&ct=g\"},\"looping\":{\"mp4_size\":\"1264801\",\"mp4\":\"https://media0.giphy.com/media/ZGH8VtTZMmnwzsYYMf/giphy-loop.mp4?cid=ca373e9auminic0o5gpi2kjp19m8wd19eicgkci0siyp18mr&rid=giphy-loop.mp4&ct=g\"},\"original_still\":{\"height\":\"270\",\"width\":\"480\",\"size\":\"43878\",\"url\":\"https://media0.giphy.com/media/ZGH8VtTZMmnwzsYYMf/giphy_s.gif?cid=ca373e9auminic0o5gpi2kjp19m8wd19eicgkci0siyp18mr&rid=giphy_s.gif&ct=g\"},\"original_mp4\":{\"height\":\"270\",\"width\":\"480\",\"mp4_size\":\"178155\",\"mp4\":\"https://media0.giphy.com/media/ZGH8VtTZMmnwzsYYMf/giphy.mp4?cid=ca373e9auminic0o5gpi2kjp19m8wd19eicgkci0siyp18mr&rid=giphy.mp4&ct=g\"},\"preview\":{\"height\":\"204\",\"width\":\"362\",\"mp4_size\":\"30658\",\"mp4\":\"https://media0.giphy.com/media/ZGH8VtTZMmnwzsYYMf/giphy-preview.mp4?cid=ca373e9auminic0o5gpi2kjp19m8wd19eicgkci0siyp18mr&rid=giphy-preview.mp4&ct=g\"},\"preview_gif\":{\"height\":\"58\",\"width\":\"103\",\"size\":\"46753\",\"url\":\"https://media0.giphy.com/media/ZGH8VtTZMmnwzsYYMf/giphy-preview.gif?cid=ca373e9auminic0o5gpi2kjp19m8wd19eicgkci0siyp18mr&rid=giphy-preview.gif&ct=g\"},\"preview_webp\":{\"height\":\"130\",\"width\":\"232\",\"size\":\"46478\",\"url\":\"https://media0.giphy.com/media/ZGH8VtTZMmnwzsYYMf/giphy-preview.webp?cid=ca373e9auminic0o5gpi2kjp19m8wd19eicgkci0siyp18mr&rid=giphy-preview.webp&ct=g\"},\"hd\":{\"height\":\"1080\",\"width\":\"1920\",\"mp4_size\":\"2308804\",\"mp4\":\"https://media0.giphy.com/media/ZGH8VtTZMmnwzsYYMf/giphy-hd.mp4?cid=ca373e9auminic0o5gpi2kjp19m8wd19eicgkci0siyp18mr&rid=giphy-hd.mp4&ct=g\"},\"480w_still\":{\"height\":\"270\",\"width\":\"480\",\"size\":\"935092\",\"url\":\"https://media0.giphy.com/media/ZGH8VtTZMmnwzsYYMf/480w_s.jpg?cid=ca373e9auminic0o5gpi2kjp19m8wd19eicgkci0siyp18mr&rid=480w_s.jpg&ct=g\"}},\"user\":{\"avatar_url\":\"https://media0.giphy.com/avatars/mostexpensivest/cygvi0t3e64D.jpg\",\"banner_image\":\"https://media0.giphy.com/headers/mostexpensivest/oPtwCPCUQ2Uj.jpg\",\"banner_url\":\"https://media0.giphy.com/headers/mostexpensivest/oPtwCPCUQ2Uj.jpg\",\"profile_url\":\"https://giphy.com/mostexpensivest/\",\"username\":\"mostexpensivest\",\"display_name\":\"MOST EXPENSIVEST\",\"description\":\"Better get your stacks in line, Jack, because 2 Chainz is back for an extravagant third season. The future of meat, technology, sex toys, and more 0’s than you can count make this the most globally responsible and financially foolish season yet.\",\"instagram_url\":\"\",\"website_url\":\"https://www.viceland.com/en_us/show/most-expensivest\",\"is_verified\":true},\"analytics_response_payload\":\"e=Z2lmX2lkPVpHSDhWdFRaTW1ud3pzWVlNZiZldmVudF90eXBlPUdJRl9TRUFSQ0gmY2lkPWNhMzczZTlhdW1pbmljMG81Z3BpMmtqcDE5bTh3ZDE5ZWljZ2tjaTBzaXlwMThtciZjdD1naWY\",\"analytics\":{\"onload\":{\"url\":\"https://giphy-analytics.giphy.com/v2/pingback_simple?analytics_response_payload=e%3DZ2lmX2lkPVpHSDhWdFRaTW1ud3pzWVlNZiZldmVudF90eXBlPUdJRl9TRUFSQ0gmY2lkPWNhMzczZTlhdW1pbmljMG81Z3BpMmtqcDE5bTh3ZDE5ZWljZ2tjaTBzaXlwMThtciZjdD1naWY&action_type=SEEN\"},\"onclick\":{\"url\":\"https://giphy-analytics.giphy.com/v2/pingback_simple?analytics_response_payload=e%3DZ2lmX2lkPVpHSDhWdFRaTW1ud3pzWVlNZiZldmVudF90eXBlPUdJRl9TRUFSQ0gmY2lkPWNhMzczZTlhdW1pbmljMG81Z3BpMmtqcDE5bTh3ZDE5ZWljZ2tjaTBzaXlwMThtciZjdD1naWY&action_type=CLICK\"},\"onsent\":{\"url\":\"https://giphy-analytics.giphy.com/v2/pingback_simple?analytics_response_payload=e%3DZ2lmX2lkPVpHSDhWdFRaTW1ud3pzWVlNZiZldmVudF90eXBlPUdJRl9TRUFSQ0gmY2lkPWNhMzczZTlhdW1pbmljMG81Z3BpMmtqcDE5bTh3ZDE5ZWljZ2tjaTBzaXlwMThtciZjdD1naWY&action_type=SENT\"}}}],\"pagination\":{\"total_count\":4906,\"count\":1,\"offset\":0},\"meta\":{\"status\":200,\"msg\":\"OK\",\"response_id\":\"uminic0o5gpi2kjp19m8wd19eicgkci0siyp18mr\"}}", HttpStatus.OK);
        when(gifClient.getGif(null, "rich")).thenReturn(gifRichJSON);
        when(gifClient.getGif(null, "broke")).thenReturn(gifBrokeJSON);
        when(gifClient.getGif(null, "123")).thenThrow(JSONException.class);
        when(currencyController.getCurrencyPairFromTwoDays("USD1")).thenThrow(IncorrectCurrencyException.class);
    }

    @Test
    public void getRichGifTest() throws IncorrectCurrencyException {
        Currency today = new Currency(72.171);
        Currency yesterday = new Currency(72.0995);
        when(currencyController.getCurrencyPairFromTwoDays("USD")).thenReturn(new CurrencyPair(today, yesterday));

        ReflectionTestUtils.setField(gifController, "gifRich", "rich");
        ReflectionTestUtils.setField(gifController, "gifBroke", "broke");

        Gif gif = gifController.getGif("USD");
        assertEquals(gif.getType(), "rich");
    }

    @Test
    public void getBrokeGifTest() throws IncorrectCurrencyException {
        Currency yesterday = new Currency(72.171);
        Currency today = new Currency(72.0995);
        when(currencyController.getCurrencyPairFromTwoDays("USD")).thenReturn(new CurrencyPair(today, yesterday));

        ReflectionTestUtils.setField(gifController, "gifRich", "rich");
        ReflectionTestUtils.setField(gifController, "gifBroke", "broke");

        Gif gif = gifController.getGif("USD");
        assertEquals(gif.getType(), "broke");
    }


    @Test
    public void incorrectGifNameTest() throws IncorrectCurrencyException {
        Currency yesterday = new Currency(72.171);
        Currency today = new Currency(72.0995);
        when(currencyController.getCurrencyPairFromTwoDays("USD")).thenReturn(new CurrencyPair(today, yesterday));

        ReflectionTestUtils.setField(gifController, "gifRich", "123");
        ReflectionTestUtils.setField(gifController, "gifBroke", "123");

        Gif gif = gifController.getGif("USD");
        assertNull(gif);
    }

    @Test
    public void getRichGifWithIncorrectCurrencyCodeTest() {

        ReflectionTestUtils.setField(gifController, "gifRich", "rich");
        ReflectionTestUtils.setField(gifController, "gifBroke", "broke");

        assertThrows(IncorrectCurrencyException.class, () -> { gifController.getGif("USD1");});

    }
}
